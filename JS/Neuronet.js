var inputDim =[];
const width = 5;
const height = 5;

function xy(x,y){
    let x0 = Math.floor(x/70);
    let y0 = Math.floor(y/70);
    return [x0,y0]
}

inputDim.length = 25;
for(let i =0; i<inputDim.length; i++){
    inputDim[i]=0;
}
var w1 =[[-0.50514507, -0.82434571,  0.16674756,  1.80485244, -1.55884255,
    0.95994933, -0.24189314, -1.21424895, -1.10128112, -0.22249276,
    1.38752552,  0.29957955, -0.45887793, -0.14579432, -0.67821821,
   -1.51250547, -1.34178864, -0.68691953, -1.17168909,  1.59017179], [-0.99885431, -1.5300193 ,  0.55846665, -0.16013689, -0.98696282,
   -1.42654976,  0.81827447,  0.67951787,  0.30093461, -1.06694139,
   -1.43331588, -0.66014966, -0.09788617,  2.01453259, -2.63929329,
   -0.23218393,  0.69280601,  2.44226004, -0.99592009, -0.34510358], [ 1.29709005, -1.59780072, -2.35462866, -3.68645127, -1.21755144,
   -0.87093633, -1.71145745,  0.12824092,  1.38942857, -0.91828511,
    0.73808337,  0.62834034, -0.10899315,  3.43637859,  0.39007345,
    0.3351642 ,  0.86161239, -0.53026221, -0.69591824, -0.16627023], [ 0.89854331,  0.67974509,  0.88556364,  2.28320389, -0.10093398,
   -0.03731604, -0.96140255, -1.12738966,  1.43895266, -0.63605347,
   -0.15798646, -0.02868919, -0.94941603, -0.73996018, -0.39212575,
   -1.59312828,  1.31036013,  0.72637785,  1.51551987, -0.762727  ], [ 0.24574403, -2.47785768,  2.39305255,  0.29696713, -0.62034385,
    0.92279067,  0.19490255, -1.59527086,  0.86488078,  0.32365423,
   -0.88740275, -0.62992269,  0.35689079, -0.42256926,  1.75201968,
    1.17631088,  1.03371044,  0.30680391, -1.15804927, -0.16684218], [-0.40637452,  1.57989815,  1.35507252, -1.29938685,  0.06780962,
    0.62081537,  1.15236799,  0.40411691,  0.55645929, -0.93712622,
   -0.61171603, -1.61596234, -0.07919105, -3.64351746, -0.52912938,
   -0.55418979,  0.31120069,  0.57110377,  0.82728079, -0.42840209], [-0.44797988,  2.18284769, -1.90943104,  0.73158996,  0.80016884,
   -0.58446186,  0.16409238,  0.47076893, -1.71039902,  1.24637717,
    0.47972503,  0.46530825, -1.65002733, -0.52643704, -0.18924984,
    0.73211892, -1.76052369,  0.31949018, -1.96676922, -1.92584783], [-2.40397171, -0.28253217, -0.66999377, -1.30067974, -1.20112383,
    0.39994644, -1.15560501, -1.52196499, -1.45689726,  1.69820913,
    1.9060822 , -0.03609163, -0.87392604,  0.05659132,  1.16763965,
    0.66764218,  0.6543727 ,  1.21979748, -1.86147039,  0.55812198], [-3.46209799, -1.8747942 ,  0.40107271,  1.48904825, -1.1395803 ,
   -0.50518956,  0.24833173,  1.20790252, -0.22446098,  0.04971681,
    1.1577751 ,  0.58680911, -1.68656253,  1.39774102,  0.37653171,
   -0.61403644, -0.70993463, -0.98068088, -1.31861225, -0.66371227], [-2.23988351e+00, -9.38149531e-01, -1.23055018e-01, -3.95033741e-01,
    1.02322935e-01,  3.02893548e+00,  2.57385810e-01, -8.58551342e-01,
    1.38965843e+00, -2.90929078e+00,  1.08642763e+00,  2.88514103e-01,
   -2.05812964e-01, -2.85180865e-03, -8.34470121e-01, -5.54990909e-02,
    1.76957173e-01,  4.30594780e-01, -3.10357240e-01,  6.32133013e-01], [-0.55582861,  0.52354083,  0.79424422, -0.07870312, -0.30503342,
    0.68996388, -0.87587852, -0.06284531, -1.80033167, -1.00577335,
   -0.17523001,  0.01493823,  0.29748511,  0.07413669, -0.91544684,
    0.72708061, -0.63178482, -0.08512254, -1.2887115 ,  0.84264451], [ 0.56641057,  0.31026482,  1.22294955,  0.87616387, -1.29866271,
   -0.16435786,  0.18183886, -1.22560067,  0.88687551,  0.10256184,
    2.2875653 , -0.08913616,  0.07633113, -2.59540845,  0.75242867,
   -1.03395746, -1.25446958, -2.82503826, -1.18979671, -0.91018163], [ 1.47894705,  1.93036828,  0.24514869, -2.5342022 ,  0.09349024,
   -1.35284117, -0.33154328,  0.83703713, -0.15236615, -0.497679  ,
   -2.42457457, -0.08580807,  0.96799088,  0.07826732,  0.0323715 ,
    0.37577319, -1.50268559,  1.0895998 ,  1.41682584,  0.54064086], [-0.72153611,  1.18472057,  0.39543396,  1.31841923,  0.16032189,
    0.37462828, -1.30907066, -0.65783924, -2.49069528, -2.00469744,
   -0.04741466,  0.69032835,  0.99825471, -1.5413837 , -1.03439183,
    0.23539703, -0.50292182, -1.63452944, -0.4984048 ,  1.02858373], [ 0.12258969,  0.89510925,  0.28613155,  1.33307919, -2.54408174,
    0.64553435, -1.18236507,  0.23722382,  0.25499282, -1.02847732,
   -0.39203946,  0.43290377,  0.74626931,  0.87482974,  1.23790379,
   -0.64586843,  0.16716748, -0.06851805,  0.96381395,  0.18683328], [ 0.9684046 , -2.96356851,  1.38184121,  0.09008624, -0.68377825,
    0.30229558,  0.45609666,  0.60270007, -0.18243634, -0.43836959,
   -2.3415004 ,  2.63646755,  0.24336583,  0.30192725,  1.07748717,
   -1.52847751,  0.61129399,  0.63164724, -0.73525633,  1.87320596], [ 1.37819803, -2.4691379 ,  0.1563079 , -0.82577354,  0.52791432,
   -1.02774894,  0.31830287, -0.70038782, -1.30940536,  1.21927695,
    0.06596405,  2.36077844,  0.76756383, -1.17394903, -1.03302402,
   -1.5721419 ,  0.22464215,  1.00051811, -0.37919744,  1.70743624], [ 0.71360162,  1.63507218, -0.01511356, -0.44202198, -1.15510444,
    1.32774174, -1.20849444,  0.63270884,  0.53694766,  1.66085832,
    1.0031991 ,  1.76903969, -0.32141759,  1.70783752, -3.44722205,
   -0.8221829 , -0.91674955,  0.25610165, -2.20659517,  0.07849146], [-2.58710554,  0.90997416,  0.69276946, -2.70338121, -0.17131826,
    0.28852606,  1.82007374, -0.57364369, -2.65775621, -0.14572838,
    1.58612048,  1.88946703,  0.3927555 , -0.94093138, -0.29528115,
   -0.29218565,  0.1774202 , -2.09846766, -0.60863075,  1.88449777], [-1.04805578, -0.45830198,  0.71585194, -1.35911424,  0.45312304,
   -0.76609905, -0.34963977,  1.91898207,  1.24912173,  1.0002838 ,
    0.90430822,  0.50193419,  1.75996308,  0.21479566,  2.01744473,
   -1.47950573, -0.62100882,  0.86079195,  1.53147475,  0.74656636], [-0.63041725,  1.17761066, -0.9231017 ,  1.2734534 ,  1.57353232,
   -0.56910941,  1.1079818 ,  0.15406238, -1.20359911,  2.62362997,
    0.36803173,  1.66903664, -0.35593689, -0.14636092,  0.38503968,
    2.1610183 , -1.60432241, -0.96772884,  0.61049268, -0.68846316], [ 1.39497024,  1.59083129,  0.22062633,  1.01321714, -0.65143025,
   -0.80446013, -0.53922616, -0.35137071, -0.3053346 ,  0.16852911,
    0.46727203,  3.53546399,  0.26381361,  0.67137029, -0.10356617,
    0.23940094, -2.11645675,  0.8143194 , -0.5134194 , -1.15153522], [ 1.93739612,  0.40736841, -0.69215804, -0.38737622,  0.04781764,
    0.08844146,  0.21941918, -0.56626717, -1.74123737,  0.4992816 ,
   -0.56677849,  1.23272106, -1.20387929, -1.72062635,  0.86365763,
    0.20900879,  0.04567696,  0.78726615,  1.63678062, -1.94055211], [ 1.7649094 , -0.07401118, -0.91547816,  1.5289591 ,  1.5145123 ,
    3.1595796 ,  0.36237451, -1.21058662,  1.79921247,  0.12883537,
   -0.80319424,  0.8773468 , -1.33848292,  0.64514685,  0.83352544,
   -0.52199762, -1.24814863, -1.1126779 ,  1.52604205, -0.08386652], [ 0.33967354, -3.28441716, -0.10640952,  0.41361014, -1.64696572,
    0.01334257, -0.66261513, -0.40262093, -1.04853378, -0.2741302 ,
   -1.38861304,  0.37349163, -0.03417777, -1.16758783,  0.67753689,
   -1.51390688,  1.20902442, -0.40381602, -1.31606548,  0.42612024]];
console.log(w1.length);
var w2 =[[-2.01009771,  0.13439073,  2.10539219, -0.75799024, -0.82374403,
    1.46508046,  2.86374892, -1.97174211, -1.53262233, -3.04734801], [-1.32643568,  2.02726631, -2.98203075, -0.04715623,  3.99572922,
    3.34357948, -0.54422561, -1.20301424, -1.65496771,  2.62906495], [-0.59215061,  0.90136109,  1.53382164,  2.22633855, -1.07949416,
    0.70054455,  2.61728579, -0.6541297 , -1.06156894, -0.09103523], [-0.15864121,  0.71901792,  2.44605847,  0.8624567 ,  1.18072875,
   -1.76011297, -1.98759383,  0.82734757, -3.0540571 , -1.04046021], [ 2.56917507, -0.6403176 , -0.31787697,  0.64316029,  2.09971066,
   -1.87216867,  0.4323808 , -0.5109052 , -0.26896572, -0.49524724], [ 0.49326187,  0.94367724,  0.56097391, -0.13319834, -1.87875673,
   -1.36718969,  0.68232579, -1.8059295 ,  2.87972278,  1.36058943], [ 1.88219715,  1.3777649 ,  0.33230762, -1.7915423 , -0.3718281 ,
    0.72837802,  0.53725467, -1.15853617,  0.28893768, -2.1407331 ], [ 0.50650447,  0.64327902,  0.63291538,  0.41424192,  0.33332797,
   -0.9316899 ,  1.06776819, -1.82488038, -0.14072773,  0.93727322], [ 2.21555053, -0.16073134, -0.68056005,  0.15501783, -0.37803428,
   -1.48535871, -1.55363348,  0.39283163, -0.07931319, -0.80458975], [-0.58575214,  2.31135235, -0.84929567,  2.04689619, -1.08923011,
   -1.30255391, -1.73635046,  0.55647207,  2.1830382 ,  0.81854262], [ 3.06180955, -1.19309808, -1.8512128 ,  2.4831482 ,  1.30009011,
   -2.01909473,  0.85185977, -1.38225945, -1.07459058,  1.54055164], [ 1.81062334, -1.71678693,  1.23412312,  0.16856827, -3.19557533,
   -1.56869442,  0.93601675, -1.20774939,  3.04547565,  0.47644796], [-0.22261296, -0.70589397, -0.62096851,  0.88619427,  1.29872485,
   -0.06992586, -0.38997795, -0.63244748,  1.82226372, -1.1696974 ], [ 0.18741629,  1.56410217, -0.22170012,  1.19609267, -0.13958982,
   -1.30195711, -0.2202125 ,  3.81264026, -1.95138589, -1.5583687 ], [-1.17199226,  0.74753925, -1.55553235, -1.44614543,  1.26230851,
    1.52993824, -0.28930189,  0.24374077, -1.24716124,  1.41031276], [ 0.83330119, -2.15113169,  1.28416449, -0.02317571,  0.21237555,
    0.5030535 ,  0.193403  ,  0.11218112,  0.98545512,  1.1446007 ], [-0.31039584,  0.09368642,  0.29598283, -1.01597008,  0.01375487,
   -0.42227753,  0.43519747,  2.36804926,  1.36662958,  1.20330669], [ 3.29005198, -0.27456809,  2.17710468, -0.96638753, -0.79301473,
    0.27627224, -2.24846622,  0.47273247, -0.94043902, -0.05492375], [ 0.48807559, -0.97050524, -1.80515346,  3.99154606, -0.05360479,
    0.52386963, -0.68251104, -0.123726  , -0.84886697,  0.21205755], [ 1.19403046, -1.037051  ,  0.12151664, -0.2995348 ,  1.05004668,
   -0.9593071 , -0.50077548, -1.19928301, -0.17235961,  0.25267144]];

var FreeVecA =[-1.02000054,  1.44254917, -1.26902252,  2.2182431 , -1.16060789,
    -1.69873008, -0.93348905, -1.79250708, -0.6438017 ,  0.00348074,
    -1.04007136, -2.11755423, -0.10736671,  0.28673042,  0.48336391,
    -2.01313805, -1.40715552, -1.49697861,  1.19062381, -1.07723138];

var FreeVecB =[-1.70136414, -0.8920976 , -0.52994163, -0.60388795,  0.35741286,
    -0.01650271, -0.13077214, -0.12158745,  0.27740692, -0.94427156];




var canvas = document.getElementById("mycanv");
var ctx = canvas.getContext("2d");
canvas.addEventListener('mousedown', function (e) {//отрисовка кружочков и запись их позиции в массив
    let x = e.pageX - e.target.offsetLeft,
        y = e.pageY - e.target.offsetTop;
    let newxy = xy(x,y);
    ctx.beginPath();
    ctx.fillStyle = "black";
    ctx.strokeStyle = "black";
    ctx.lineWidth = 1;
    ctx.fillRect(newxy[0]*70,newxy[1]*70,70,70);
    inputDim[5*newxy[1]+ newxy[0]] = 1;
    ctx.stroke();
    ctx.closePath();
});


var textfield = document.getElementById("input");
var clear = document.getElementById("clear");
clear.onclick = function(){
    ctx.clearRect(0,0,canvas.width, canvas.height);
    for(let i = 0; i<inputDim.length; i++){
        inputDim[i]=0;
    }
    textfield.value = "";
}
function play() {
    var audio = new Audio();
    audio.src = '../music/neurosound.mp3';
    audio.autoplay = true;
}

//функция активации
function relu(Matrix){
    let tempMatrix = [];
    for(let i = 0; i<Matrix.length; i++){
        tempMatrix.push(Math.max(0, Matrix[i]));
    }
    return tempMatrix;
}

function getMaxOfArray(numArray) {
    return Math.max.apply(null, numArray);
}

//softmax
function softmax(Vector){
    let temp1 = 0;
    let temp2= 0;
    let softmaxVector1 = [];
    let softmaxVector2 = [];
    for(let i =0; i< Vector.length; i++){
        temp1 = Math.exp(Vector[i]);
        temp2+=temp1;
        softmaxVector1.push(temp1);
    }
    for(let i = 0; i < softmaxVector1.length; i++){
        softmaxVector2.push(softmaxVector1[i]/temp2);
    }
    return softmaxVector2;
}

//перемножение векторов
function multiply(VecA, MatrixW, FreeVec){
    let MatrixResult = [];
    for (let i = 0; i<MatrixW[0].length; i++){
        MatrixResult[i] = 0;
    }
    console.log(MatrixResult);
    for(let i = 0; i<VecA.length; i++){
        for(let j = 0; j<MatrixW[i].length; j++){
            MatrixResult[j] +=VecA[i]*MatrixW[i][j];
        }
    }
    for (let i = 0; i<FreeVec.length; i++){
        MatrixResult[i]+=FreeVec[i];
    }
    return MatrixResult;
}

function neuronet(){
    let hideDim = [];
    let outputDim1 = [];
    let outputDim2 = [];

    //сама нейросеть
    //написать считывание изображения

    //считаем первый скрытый слой
    t1 = multiply(inputDim, w1, FreeVecA);
    
    hideDim = relu(t1);

    //считаем выходной слой
    outputDim1 = multiply(hideDim, w2, FreeVecB);
    
    //выбираем вероятность
    outputDim2 = softmax(outputDim1);

    //максимальное число
    return (outputDim2.findIndex(i => i==getMaxOfArray(outputDim2)));
}


var colcul = document.getElementById("calculating");
colcul.onclick = function(){
    play();
    let predict = neuronet();
    textfield.value = predict;
}